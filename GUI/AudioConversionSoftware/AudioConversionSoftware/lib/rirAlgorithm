import roomsimove_single
import ipdb
import soundfile as sf
import olafilt
import numpy as np


def rirAlgorithm(filepath, roomSize, lenghtToSound, soundAngle):
    rt60 = 0.4
    room_dim = [roomSize, roomSize, roomSize]
    sound_source = [soundAngle, 1, lenghtToSound]

    center = [roomSize * 0.5, 1, roomSize * 0.5]
    mic_pos_1 = center
    mic_pos_2 = [center[0], center[1], center[2] + 1]
    mic_positions = [mic_pos_1, mic_pos_2]

    rir = roomsimove_single.do_everything(room_dim, mic_positions, sound_source, rt60)

    ipdb.set_trace()

    [data, fs] = sf.read(filepath, always_2d=True)
    data = data[:, 0]
    data_rev_ch1 = olafilt.olafilt(rir[:, 0], data)
    data_rev_ch2 = olafilt.olafilt(rir[:, 1], data)
    data_rev = np.array([data_rev_ch1, data_rev_ch2])
    sf.write('output.wav', data_rev.T, fs)
